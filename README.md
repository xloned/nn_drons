# NN Drones - Hole Finding Simulation

Симуляция роя дронов, которые используют нейронные сети и обучение с подкреплением (Reinforcement Learning) для поиска отверстия в стене.

## Описание

Проект реализует:
- 3D симуляцию с OpenGL
- Рой из 5 дронов (можно увеличить)
- Нейронную сеть для каждого дрона (18 входов -> 16 -> 12 -> 4 выхода)
- Эволюционное обучение (evolutionary strategy)
- Координацию роя (когда один дрон находит отверстие, остальные летят к нему)
- Сохранение/загрузку обученной модели

## Требования

### macOS
```bash
brew install glfw glm eigen
```

### Linux (Ubuntu/Debian)
```bash
sudo apt-get install libglfw3-dev libglm-dev libeigen3-dev
```

### Windows
Используйте vcpkg или скачайте библиотеки вручную:
```bash
vcpkg install glfw3 glm eigen3
```

## Сборка

```bash
mkdir build
cd build
cmake ..
make
```

## Запуск

Обычный запуск (обучение с нуля):
```bash
./nndrons
```

Загрузка сохраненной модели:
```bash
./nndrons --load
```

## Управление

- **Стрелки**: Поворот камеры
- **W/S**: Приближение/отдаление камеры
- **ESC**: Выход

## Как работает

### Сенсоры дрона (18 входов):
1. Позиция дрона (x, y, z) - 3 значения
2. Скорость дрона (vx, vy, vz) - 3 значения
3. Направление к отверстию - 3 значения
4. Расстояние до отверстия - 1 значение
5. Лучи в 8 направлениях (расстояние до препятствий) - 8 значений

### Выходы нейросети (4 значения):
- Сила движения по X, Y, Z осям
- Используются для управления дроном

### Система наград:
- **+100**: Прохождение через отверстие
- **-50**: Столкновение со стеной
- **+0.5 * (20 - distance)**: За приближение к отверстию
- **-0.1**: За каждый шаг (стимулирует быструю находку)

### Обучение:
Используется простая эволюционная стратегия:
1. Все дроны пытаются найти отверстие
2. Вычисляется fitness для каждого дрона
3. Лучшая нейросеть клонируется
4. Клоны мутируют (изменение весов)
5. Новое поколение начинает эпизод

### Роевое поведение:
Когда один дрон успешно находит отверстие, он становится "маяком" и остальные активные дроны получают дополнительную силу, направленную к нему.

## Структура проекта

```
nndrons/
├── include/          # Заголовочные файлы
│   ├── vec3.h        # 3D вектор
│   ├── environment.h # Окружение (стена + отверстие)
│   ├── drone.h       # Дрон с сенсорами
│   ├── neural_network.h  # Нейронная сеть
│   ├── rl_trainer.h  # Тренер RL
│   ├── swarm.h       # Управление роем
│   └── renderer.h    # OpenGL рендеринг
├── src/              # Реализация
└── CMakeLists.txt    # Конфигурация сборки
```

## Параметры (можно настроить)

В коде можно изменить:
- **Количество дронов**: В [main.cpp:17](src/main.cpp#L17) измените `numDrones`
- **Архитектура нейросети**: В [swarm.cpp:22](src/swarm.cpp#L22) измените `layerSizes`
- **Скорость мутации**: В [rl_trainer.cpp:5](src/rl_trainer.cpp#L5) измените `mutationRate`
- **Максимальное время эпизода**: В [swarm.cpp:7](src/swarm.cpp#L7) измените `maxEpisodeTime`
- **Размер отверстия**: В [environment.cpp:20](src/environment.cpp#L20) измените `holeRadius`

## Автосохранение

Модель автоматически сохраняется каждые 10 поколений в файл `best_network.bin`.

## Визуализация

- **Синие сферы**: Активные дроны
- **Зеленые сферы**: Дроны, нашедшие отверстие
- **Красные сферы**: Дроны, столкнувшиеся со стеной
- **Полупрозрачная стена**: Препятствие
- **Зеленый круг**: Отверстие

## Производительность

При каждом новом поколении случайная позиция отверстия меняется, что заставляет нейросеть обобщать и искать отверстие в любом месте, а не запоминать конкретную позицию.

Обычно обучение начинает показывать результаты после 50-100 поколений.
